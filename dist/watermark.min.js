var watermarkObj=function(e){"use strict";function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function r(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var i=function(e){var t=e.str,n=e.ctx,r=e.initX,i=e.initY,o=e.lineHeight,a=(e.canvasWidth,0);t=t.replace(/\n+$/g,"");for(var c=0;c<t.length;c++)n.measureText(t[c]).width,c==t.length-1&&n.fillText(t.substring(a,c+1),r,i),"\n"==t[c]&&(0,n.fillText(t.slice(a,c),r,i),i+=o,a=c+1)},o=function(e,t){var n=null;n=e?document.querySelector(e):document.body;var r=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;return!!r&&(new r(t).observe(n,{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!0,characterDataOldValue:!0}),!0)},a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=function(e){return document.createElement("canvas").getContext("2d").measureText(e).width},o=e.split("\n"),a=o.map((function(e){return i(e)})),c=Math.max.apply(Math,r(a)),l=1.5*c,s=1.2*c,d={width:l*(1+(100-t)/100*n),height:s*(1+(100-t)/100*n)};return function(e){return d[e]}},c={id:"wm_div_id",text:"测试水印",color:"rgba(112, 113, 114, .1)",fontSize:14,parentLeft:0,parentTop:0,parentRight:0,parentBottom:0,slope:-30,zIndex:9999,parentSelector:null};function l(e){var r=function(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?n(i,!0).forEach((function(n){t(e,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({},c,{},e);d.set(r.id,r);var o=null;if(r.parentSelector?(o=document.querySelector(r.parentSelector)).style.position="relative":o=document.body,!document.getElementById(r.id)){var a=document.createElement("canvas"),l=document.createElement("div"),s=a.getContext("2d"),u=r.slope*Math.PI/180;a.id="watermarkCanvasId",a.width=r.singleWidth,a.height=r.singleHeight,s.font="normal ".concat(r.fontSize,"px 'Microsoft Yahei','serif','sans-serif'"),s.fillStyle=r.color,s.translate(a.width/2,a.height/2),s.rotate(u),s.translate(-a.width/2,-a.height/2),s.textAlign="center";var g=r.fontSize+r.fontSize/3,p=Math.ceil(Math.abs(Math.sin(u)*r.singleHeight))+r.fontSize/3,h={str:r.text,ctx:s,initX:r.singleWidth/2,initY:p,lineHeight:g,canvasWidth:r.singleWidth};i(h);var f=a.toDataURL("image/png");l.id=r.id,l.style.position="absolute",l.style.zIndex=r.zIndex,l.style.top="".concat(r.parentTop,"px"),l.style.right="".concat(r.parentRight,"px"),l.style.bottom="".concat(r.parentBottom,"px"),l.style.left="".concat(r.parentLeft,"px"),l.style.pointerEvents="none",l.style.backgroundImage="URL("+f+")",o.appendChild(l)}}var s=new Map,d=new Map;var u=a;return e.customSettingMap=d,e.getSingleWH=u,e.getWatermarkConfig=function(e){return d.get(e)||{}},e.removeWatermark=function(e){var t=document.getElementById(e);t&&t.parentNode.removeChild(t),s.set(e,!0)},e.watermark=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.singleHeight=e.singleHeight||a(e.text,e.density,e.densityBase)("height"),e.singleWidth=e.singleWidth||a(e.text,e.density,e.densityBase)("width"),l(e),window.addEventListener("resize",(function(){!s.get(e.id)&&l(e)}));var t=e.id||c.id,n=e.parentSelector||c.parentSelector;o(n,(function(n,r){n[0].removedNodes[0]&&n[0].removedNodes[0].id===t&&!s.get(e.id)&&l(e)}))||observeNode.addEventListener("DOMNodeRemoved",(function(){!s.get(e.id)&&l(e)}),!1)},e}({});
